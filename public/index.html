<!DOCTYPE html>
<html>
  <body style="background-color: bisque">
    <form id="form">
      <input
        type="text"
        name="url"
        value="https://twitter.com/ChainHackerClan/status/1616486060430589956"
      />
      <button type="submit">SUBMIT</button>
    </form>
    <div>
      <div>Screenshot Link: <a href='#' id='imagelink' target='_blank'>N/A</a></div>
      <div>JSON Link: <a href='#' id='jsonlink' target='_blank'>N/A</a></div>
      <div>OpenSea Link: <a href='#' id='opensealink' target='_blank'>N/A</a></div>
    </div>
    <div
      style="
        display: flex;
        align-items: flex-start;
        justify-content: flex-start;
        width: 100%;
        gap: 5px;
      "
    >
      <div style="flex: 0 0 45%">
        <img src="" id="image1" />
      </div>
      <div style="flex: 0 0 45%">
        <img src="" id="image2" />
      </div>
    </div>
  </body>
  <script>
    document.getElementById("form").addEventListener("submit", (event) => {
      event.preventDefault();
      console.log(event.target.url.value);
      const image1 = document.getElementById("image1");
      const image2 = document.getElementById("image2");
      image1.src = "images/wait.png";
      image2.src = "images/wait.png";      
      fetch("/send", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url: event.target.url.value }),
      }).then((response) => {
        console.log(response.status);
        response.blob().then((blob) => {
          const objectURL = URL.createObjectURL(blob);
          image1.style = "width: 90%; display: block;";
          image1.src = objectURL;
        });
        fetch(`/stamped?path=${event.target.url.value}`).then((response) => {
          response.blob().then((blob) => {
            const objectURL = URL.createObjectURL(blob);
            const image2 = document.getElementById("image2");
            image2.style = "width: 90%;  display: block;";
            image2.src = objectURL;
          });
         fetch(`/storedData?path=${event.target.url.value}`).then((response) => {
            response.json().then((data) => {
              console.log(data);
              const { imageLink, jsonLink, openseaLink } = JSON.parse(data);
              const imageLinkA = document.getElementById('imagelink');
              imageLinkA.textContent = imageLink;
              imageLinkA.href = imageLink;
              const jsonLinkA = document.getElementById('jsonlink');
              jsonLinkA.textContent = jsonLink;
              jsonLinkA.href = jsonLink;
              const openseaLinkA = document.getElementById('opensealink');
              openseaLinkA.textContent = openseaLink;
              openseaLinkA.href = openseaLink;
            })
          })
        });
      });
    });
  </script>
</html>
